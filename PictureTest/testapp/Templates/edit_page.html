{% extends 'main.html' %}

{% block title %}
Edit Page 
{% endblock %}

{% block content %}

<div class="add-page-wrapper">
    <h2>Edit Page</h2>
    <div class="add-page-body">
        <div class="left-section">
            <form action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="field-wrapper">
                    <label for="page-number">Page Number:</label>
                    <input type="text" name="page_number" id="page-number" value="{{ page.page_number }}" required>
                </div>
                <div class="field-wrapper">
                    <label for="page-image">Upload Image</label>
                    current: <img src="{% if page.image.url %}{{ page.image.url }}{% endif %}" alt="Current Image" style="max-width:100px;max-height:100px;">
                    <input type="file" name="page_image" id="page-image" accept="image/*">
                </div>
                <div class="field-wrapper">
                    <label for="page-question">Question</label>
                    <textarea name="page_question" id="page-question" cols="30" rows="10">{{ page.question }}</textarea>
                </div>
                <div class="field-wrapper">
                    <label for="test">Test:</label>
                    <select name="test" id="test" required>
                        {% for test in tests %}
                        <option value="{{ test.id }}" {% if test.id == page.test.id %}selected{% endif %}>{{ test.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="buttons">
                    <button type="submit">Save Changes</button>
                    <a href="{% url 'setup_pages_page' type.id test.id %}">Cancel</a>
                </div>
            </form>
        </div>
        <div class="right-section">
            <div class="preview-wrapper">
                <h3>Preview</h3>
                <div class="preview-body">
                    <div class="image-preview">
                        <img id="preview-image" src="{{ page.image.url }}" alt="Image Preview" style="max-width:100%;max-height:200px;{% if not page.image %}display:none;{% endif %}">
                    </div>
                    <div class="question-preview">
                        <h4>Question:</h4>
                        <p id="preview-question">{% if page.question %}{{ page.question|linebreaksbr }}{% else %}No question added yet.{% endif %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Preview the uploaded image
document.getElementById('page-image').addEventListener('change', function(event) {
    const preview = document.getElementById('preview-image');
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    } else {
        preview.src = '';
        preview.style.display = 'none';
    }

    const previewQ = document.getElementById('preview-question');
    const value = event.target.value;

    if (value.trim()) {
        // Replace newline characters with <br> for HTML rendering
        previewQ.innerHTML = value.replace(/\n/g, '<br>');
    } else {
        previewQ.innerHTML = 'No question added yet.';
    }
});

// Preview the question text
// document.getElementById('page-question').addEventListener('input', function(event) {
//     const previewQ = document.getElementById('preview-question');
//     previewQ.textContent = event.target.value || 'No question added yet.';
// });
document.getElementById('page-question').addEventListener('input', function(event) {
    const previewQ = document.getElementById('preview-question');
    const value = event.target.value;

    if (value.trim()) {
        // Replace newline characters with <br> for HTML rendering
        previewQ.innerHTML = value.replace(/\n/g, '<br>');
    } else {
        previewQ.innerHTML = 'No question added yet.';
    }
});

</script>
{% endblock %}